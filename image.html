<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title> ðŸš€ Frontend</title>
</head>
<style>
    *{
        font-family: 'poppins',sans-serif;
    }
    body{
        background: rgb(20, 20, 20);
        color: white;
        transition: all 0.5s;
        
    }
    
    .dark{
         background: rgb(20, 20, 20);
        color: black;
        background-color: rgba(255, 250, 250, 0.383);
       
        input{
          width: 90%;
        height: 5vh;
        font-family: system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;
        transition: all 0.5s;
       background: transparent;
       border:  2px solid black;
       border-radius: 3px;
        }
        .file{
            width: 90%;
            background-color: transparent;
        }
         small u{
    color: black;
    }
    li{
        background: wheat;
    }
    li:hover{
         background: rgb(233, 202, 146)
    }
     .file{
        background-color: transparent;
        border: none;
    }

   }
    .container{
      box-shadow: inset 0 0 4px aqua;  
        border-radius: 5px;
        margin: 2rem;
        padding: 2rem;
        width: 110vh;
    }
   ::placeholder{
    font-family: 'Times New Roman', Times, serif;
    font-size: 17px;   
   }
   input{
        width: 90%;
        height: 5vh;
        font-family: system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;
        transition: all 0.5s;
        background-color: rgb(37, 36, 36);
        border: none;
        color: white;
   }
   button{
    width: 40%;
    height: 5vh;
    background-color: rgb(0, 255, 81);
    border: none;
    border-radius: 3px;
    font-size: 16px;
    cursor: pointer;
   }
   .emp-img {
       width: 60px;
       height: 60px;
       border-radius: 50%;
       object-fit: cover;
       vertical-align: middle;
       margin-right: 10px;
       border: 2px solid rgb(0, 255, 106); 
   }
   .emp-img:hover{
    transform: scale(2.5);
    border-radius: 0px;
    transition: all 0.6s;
   }
   li {
       list-style: none;
       margin-bottom: 15px;
       display: flex;
       align-items: center;
       background-color: rgb(39, 38, 38);
       border-radius: 5px;
       border-top-right-radius: 30px;
       cursor: pointer;
   }
   li:hover{
    background: rgb(52, 51, 51);
   }
   strong{
    color: rgb(4, 255, 4);
    margin-left: 2vh;
   }
   small u{
    color: aqua;
    font-size: 14px;
    margin-left: 1rem;
    }
    img{
        border-color: aqua;
        border: 1px;
    }
    .file{
        background-color: transparent;
    }
</style>
<body>
    <div class="container">
        <h2>Record employees</h2>
        <input type="text" id="name" placeholder="Firstname"><br><br>
        <input type="email" id="email" placeholder="Email"><br><br>
        <input type="file" id="path" accept="image/*" class="file"><br><br>
        <button onclick="addUser()">Add user</button><br><br>
        <div class="btn-mode">
            <button id="mode">change mode</button> <span>click here to change light mode</span>
            <ul id="list" style="padding-left: 0;"></ul>
            <h2>End of employee list</h2>
        </div>
    </div>
</body>

<script>
    // Moved outside so both functions can access it
    const API_URL = "http://localhost:3000/get"; 

    const btn_dark = document.getElementById('mode');
    btn_dark.addEventListener('click', () => {
        document.body.classList.toggle('dark');
    });

    async function fetchUsers() {
        try {
            const res = await fetch(API_URL);
            const data = await res.json();
            const list = document.getElementById('list');
            list.innerHTML = "";

            data.forEach(user => {
                // Ensure image_path matches your database column name
                const imageSrc = user.image_path ? `http://localhost:3000/${user.image_path}` : 'https://via.placeholder.com/50';
                list.innerHTML += `
                <li>
                    <img src="${imageSrc}" class="emp-img" alt="profile">
                    <div class="info">${user.id}.
                        <strong>${user.name}</strong><br>
                        <small> <u> ${user.email} </u> </small>
                    </div>
                </li>`;
            });
        } catch (err) {
            console.error("Error fetching data:", err);
        }
    }

    async function addUser() {
        const name = document.getElementById('name').value;
        const email = document.getElementById('email').value;
        const imageFile = document.getElementById('path').files[0];

        if (!name || !email) {
            alert("Please fill in required fields");
            return;
        }

        const formData = new FormData();
        formData.append('name', name);
        formData.append('email', email);
        if (imageFile) {
            formData.append('image', imageFile);
        }

        try {
            const res = await fetch("http://localhost:3000/insert", {
                method: 'POST',
                body: formData
            });

            if (res.ok) {
                // Clear inputs
                document.getElementById('name').value = "";
                document.getElementById('email').value = "";
                document.getElementById('path').value = "";
                // Refresh list
                fetchUsers(); 
            } else {
                alert("Error adding user");
            }
        } catch (err) {
            console.error("Error adding user:", err);
        }
    }
    fetchUsers();
</script>
</html>